

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Global fit of a dipolar evolution function using regularization &mdash; DeerLab  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../../develop/_static/custom.css" type="text/css" /><link rel="stylesheet" href="../../develop/_static/theme_override.css" type="text/css" /><link rel="stylesheet" href="../../develop/_static/custom.css" type="text/css" />  <link rel="stylesheet" href="../_static/table_util.css" type="text/css" />
  <link rel="stylesheet" href="../_static/table_main.css" type="text/css" />
<link rel="stylesheet" href="../../develop/_static/theme_override.css" type="text/css" />    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Global fit of a time-domain parameteric 4-pulse DEER dipolar signal" href="example_globalfit_timedomain.html" />
    <link rel="prev" title="Selecting an optimal parametric model for fitting a dipolar signal" href="example_selectmodel.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div class="select">
    <select onChange="window.location.href=this.value">
        <option value="../../0.8.beta/examples/example_globalfit_regularization.html">0.8.beta</option>
        <option value="../../0.6.beta/examples/example_globalfit_regularization.html">0.6.beta</option>
        <option selected value="">develop</option>
    </select>
    <div class="select_arrow">
    </div>
</div>


<div class="select">
    <select onChange="window.location.href=this.value">
        <option value="../../0.8.beta/examples/example_globalfit_regularization.html">0.8.beta</option>
        <option selected value="">0.6.beta</option>
        <option value="../../develop/examples/example_globalfit_regularization.html">develop</option>
    </select>
    <div class="select_arrow">
    </div>
</div>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
</ul>
<p class="caption"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../download.html">Downloads</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../download.html#downloading-releases">Downloading Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html#downloading-the-source-code">Downloading the source code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#setup">Setup</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../examples.html#tutorials-basics">Tutorials - Basics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../examples.html#tutorials-advanced">Tutorials - Advanced</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions.html#modeling">Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions.html#analysis">Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions.html#pre-processing">Pre-Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions.html#model-selection">Model Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions.html#utilities">Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ddmodels.html">Distribution models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ddmodels.html#parameter-free-distance-distributions">Parameter-free distance distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ddmodels.html#parametric-distance-distributions">Parametric distance distributions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bgmodels.html">Background models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/bg_exp.html"><code class="docutils literal notranslate"><span class="pre">bg_exp</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/bg_poly1.html"><code class="docutils literal notranslate"><span class="pre">bg_poly1</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/bg_poly2.html"><code class="docutils literal notranslate"><span class="pre">bg_poly2</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/bg_poly3.html"><code class="docutils literal notranslate"><span class="pre">bg_poly3</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/bg_prodstrexp.html"><code class="docutils literal notranslate"><span class="pre">bg_prodstrexp</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/bg_strexp.html"><code class="docutils literal notranslate"><span class="pre">bg_strexp</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/bg_sumstrexp.html"><code class="docutils literal notranslate"><span class="pre">bg_sumstrexp</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../expmodels.html">Experiment models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/exp_4pdeer.html"><code class="docutils literal notranslate"><span class="pre">exp_4pdeer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/exp_5pdeer.html"><code class="docutils literal notranslate"><span class="pre">exp_5pdeer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/exp_ovl4pdeer.html"><code class="docutils literal notranslate"><span class="pre">exp_ovl4pdeer</span></code></a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DeerLab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../examples.html">Tutorials</a> &raquo;</li>
        
      <li>Global fit of a dipolar evolution function using regularization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="global-fit-of-a-dipolar-evolution-function-using-regularization">
<span id="example-globalfit-regularization"></span><h1>Global fit of a dipolar evolution function using regularization<a class="headerlink" href="#global-fit-of-a-dipolar-evolution-function-using-regularization" title="Permalink to this headline">Â¶</a></h1>
<br>
<p align="center">
        <a href="https://deertutorials.s3.eu-central-1.amazonaws.com/globalfit_regularization/globalfit_regularization.pdf" title="Download PDF file" target="_blank" download>
                <img src="../_static/img/download_pdf_button.png" class="tutorial_buttons";" alt="pdf">
        </a>
        &nbsp;&nbsp;&nbsp;
        <a href="https://deertutorials.s3.eu-central-1.amazonaws.com/globalfit_regularization/globalfit_regularization.mlx" title="Download Live Script" target="_blank">
                <img src="../_static/img/download_live_button.png" class="tutorial_buttons";" alt="live">
        </a>
        &nbsp;&nbsp;&nbsp;
        <a href="https://deertutorials.s3.eu-central-1.amazonaws.com/globalfit_regularization/globalfit_regularization.m" title="Download Source File" target="_blank">
                <img src="../_static/img/download_source_button.png" class="tutorial_buttons";" alt="pdf">
        </a>
        &nbsp;&nbsp;&nbsp;
</p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB R2019b"><title>Global fit of a dipolar evolution function using regularization</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin: 20px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S3 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S4 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S5 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S6 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>Global fit of a dipolar evolution function using regularization</span></h1><div  class = 'S1'><span>Author: Luis Fabregas This short example will introduce the use of global fitting (or global analysis) using Tikhonov regularization. </span></div><h2  class = 'S2'><span>Generating multiple datasets</span></h2><div  class = 'S1'><span>First, let's generate the three dipolar evolution functions D|1|,D|2| and D|3| (i.e. without background and full modulation depth), but different length, and noise levels. All of them arising from the same bimodal distance distribution. We assume the modulation depths to be approximately equal between measurements.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span>clear,clc,clf</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Model input parameters</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>k = 0.3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>lam = 0.35;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>rmean1 = 3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>rmean2 = 3.5;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>w1 = 0.3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>w2 = 0.3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>A1 = 0.3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Construct the axes</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>t1 = linspace(0,5,200);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>t2 = linspace(0,2,100);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>t3 = linspace(0,3,150);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Generate distance distribution</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>r = linspace(2,5,100);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>P = dd_gauss2(r,[rmean1 w1 rmean2 w2 A1]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Generate dipolar signals</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>D1 = dipolarsignal(t1,r,P,</span><span style="color: rgb(160, 32, 240);">'noiselevel'</span><span>,0.10);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>D2 = dipolarsignal(t2,r,P,</span><span style="color: rgb(160, 32, 240);">'noiselevel'</span><span>,0.02);</span></span></div></div><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre;"><span>D3 = dipolarsignal(t3,r,P,</span><span style="color: rgb(160, 32, 240);">'noiselevel'</span><span>,0.05);</span></span></div></div></div><h2  class = 'S6'><span>Global fit</span></h2><div  class = 'S1'><span>Doing this global fit does not require any additional steps in comparison to the local fits. In order to perform the fit in a global way, we only need to pass all signals as a cell array</span><span> </span><span style=' font-family: monospace;'>{D1,D2,D3}</span><span> as well as the dipolar kernels for each signal.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Construct the dipolar kernels</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>K1 = dipolarkernel(t1,r);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>K2 = dipolarkernel(t2,r);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>K3 = dipolarkernel(t3,r);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Run global fit of time-domain parameteric model</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>Pfit = fitregmodel({D1,D2,D3},{K1,K2,K3},r,</span><span style="color: rgb(160, 32, 240);">'tikh'</span><span>,</span><span style="color: rgb(160, 32, 240);">'aic'</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Get the time-domain fits of all signals</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>D1fit = K1*Pfit;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>D2fit = K2*Pfit;</span></span></div></div><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre;"><span>D3fit = K3*Pfit;</span></span></div></div></div><div  class = 'S1'><span>Finally we can plot all our results and compare them to the ground truth.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Plotting</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>figure(</span><span style="color: rgb(160, 32, 240);">'position'</span><span>,[0 0 600 200]),clf</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>subplot(121)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>plot(t1,D1,</span><span style="color: rgb(160, 32, 240);">'k.'</span><span>,t1,D1fit,</span><span style="color: rgb(160, 32, 240);">'b'</span><span>,t2,D2+1/2,</span><span style="color: rgb(160, 32, 240);">'k.'</span><span>,t2,D2fit+1/2,</span><span style="color: rgb(160, 32, 240);">'b'</span><span>,t3,D3+1,</span><span style="color: rgb(160, 32, 240);">'k.'</span><span>,t3,D3fit+1,</span><span style="color: rgb(160, 32, 240);">'b'</span><span>,</span><span style="color: rgb(160, 32, 240);">'LineWidth'</span><span>,1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>grid </span><span style="color: rgb(160, 32, 240);">on</span><span>,axis </span><span style="color: rgb(160, 32, 240);">tight</span><span>,box </span><span style="color: rgb(160, 32, 240);">on</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>xlabel(</span><span style="color: rgb(160, 32, 240);">'time [\mus]'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ylabel(</span><span style="color: rgb(160, 32, 240);">'V_i(t)'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>set(gca,</span><span style="color: rgb(160, 32, 240);">'FontSize'</span><span>,14)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>subplot(122)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>plot(r,P,</span><span style="color: rgb(160, 32, 240);">'k'</span><span>,r,Pfit,</span><span style="color: rgb(160, 32, 240);">'b'</span><span>,</span><span style="color: rgb(160, 32, 240);">'LineWidth'</span><span>,1.5)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>grid </span><span style="color: rgb(160, 32, 240);">on</span><span>,axis </span><span style="color: rgb(160, 32, 240);">tight</span><span>,box </span><span style="color: rgb(160, 32, 240);">on</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>xlabel(</span><span style="color: rgb(160, 32, 240);">'distance [nm]'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ylabel(</span><span style="color: rgb(160, 32, 240);">'P(r) [nm^{-1}]'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre;"><span>set(gca,</span><span style="color: rgb(160, 32, 240);">'FontSize'</span><span>,14)</span></span></div></div></div><h2  class = 'S6'><span>Studying the influence of the global weights</span></h2><div  class = 'S1'><span>By default, the global weights, i.e. how much influence each signal has on the global fit, are chosen automatically based on the individual signal lengths and approximate noise levels. However, this weights can be specified by passing the option</span><span> </span><span style=' font-family: monospace;'>'GlobalWeights</span><span>'. In this example, the signal</span><span> </span><span style=' font-family: monospace;'>D1</span><span> has the largest amount of points and the highest noise. Hence by default this signals will be less weighted than the others. In this last section we want to study the effect of setting all weights equal for all signals has on the gobal fit.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Set all global weigths equal (w=1/3)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>weights = ones(3,1)/3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Run global fit of time-domain parameteric model</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>Pfit = fitregmodel({D1,D2,D3},{K1,K2,K3},r,</span><span style="color: rgb(160, 32, 240);">'tikh'</span><span>,</span><span style="color: rgb(160, 32, 240);">'aic'</span><span>,</span><span style="color: rgb(160, 32, 240);">'GlobalWeights'</span><span>,weights);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Get the time-domain fits of all signals</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>D1fit = K1*Pfit;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>D2fit = K2*Pfit;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>D3fit = K3*Pfit;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">%Plotting</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>figure(</span><span style="color: rgb(160, 32, 240);">'position'</span><span>,[0 0 600 200]),clf</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>subplot(121)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>plot(t1,D1,</span><span style="color: rgb(160, 32, 240);">'k.'</span><span>,t1,D1fit,</span><span style="color: rgb(160, 32, 240);">'b'</span><span>,t2,D2+1/2,</span><span style="color: rgb(160, 32, 240);">'k.'</span><span>,t2,D2fit+1/2,</span><span style="color: rgb(160, 32, 240);">'b'</span><span>,t3,D3+1,</span><span style="color: rgb(160, 32, 240);">'k.'</span><span>,t3,D3fit+1,</span><span style="color: rgb(160, 32, 240);">'b'</span><span>,</span><span style="color: rgb(160, 32, 240);">'LineWidth'</span><span>,1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>grid </span><span style="color: rgb(160, 32, 240);">on</span><span>,axis </span><span style="color: rgb(160, 32, 240);">tight</span><span>,box </span><span style="color: rgb(160, 32, 240);">on</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>xlabel(</span><span style="color: rgb(160, 32, 240);">'time [\mus]'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ylabel(</span><span style="color: rgb(160, 32, 240);">'V_i(t)'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>set(gca,</span><span style="color: rgb(160, 32, 240);">'FontSize'</span><span>,14)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>subplot(122)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>plot(r,P,</span><span style="color: rgb(160, 32, 240);">'k'</span><span>,r,Pfit,</span><span style="color: rgb(160, 32, 240);">'b'</span><span>,</span><span style="color: rgb(160, 32, 240);">'LineWidth'</span><span>,1.5)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>grid </span><span style="color: rgb(160, 32, 240);">on</span><span>,axis </span><span style="color: rgb(160, 32, 240);">tight</span><span>,box </span><span style="color: rgb(160, 32, 240);">on</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>xlabel(</span><span style="color: rgb(160, 32, 240);">'distance [nm]'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ylabel(</span><span style="color: rgb(160, 32, 240);">'P(r) [nm^{-1}]'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre;"><span>set(gca,</span><span style="color: rgb(160, 32, 240);">'FontSize'</span><span>,14)</span></span></div></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Global fit of a dipolar evolution function using regularization
% Author: Luis Fabregas This short example will introduce the use of global 
% fitting (or global analysis) using Tikhonov regularization. 
%% Generating multiple datasets
% First, let's generate the three dipolar evolution functions D|1|,D|2| and 
% D|3| (i.e. without background and full modulation depth), but different length, 
% and noise levels. All of them arising from the same bimodal distance distribution. 
% We assume the modulation depths to be approximately equal between measurements.

clear,clc,clf

%Model input parameters
k = 0.3;
lam = 0.35;
rmean1 = 3;
rmean2 = 3.5;
w1 = 0.3;
w2 = 0.3;
A1 = 0.3;

%Construct the axes
t1 = linspace(0,5,200);
t2 = linspace(0,2,100);
t3 = linspace(0,3,150);

%Generate distance distribution
r = linspace(2,5,100);
P = dd_gauss2(r,[rmean1 w1 rmean2 w2 A1]);

%Generate dipolar signals
D1 = dipolarsignal(t1,r,P,'noiselevel',0.10);
D2 = dipolarsignal(t2,r,P,'noiselevel',0.02);
D3 = dipolarsignal(t3,r,P,'noiselevel',0.05);
%% Global fit
% Doing this global fit does not require any additional steps in comparison 
% to the local fits. In order to perform the fit in a global way, we only need 
% to pass all signals as a cell array |{D1,D2,D3}| as well as the dipolar kernels 
% for each signal.

%Construct the dipolar kernels
K1 = dipolarkernel(t1,r);
K2 = dipolarkernel(t2,r);
K3 = dipolarkernel(t3,r);

%Run global fit of time-domain parameteric model
Pfit = fitregmodel({D1,D2,D3},{K1,K2,K3},r,'tikh','aic');

%Get the time-domain fits of all signals
D1fit = K1*Pfit;
D2fit = K2*Pfit;
D3fit = K3*Pfit;
%% 
% Finally we can plot all our results and compare them to the ground truth.

%Plotting
figure('position',[0 0 600 200]),clf

subplot(121)
plot(t1,D1,'k.',t1,D1fit,'b',t2,D2+1/2,'k.',t2,D2fit+1/2,'b',t3,D3+1,'k.',t3,D3fit+1,'b','LineWidth',1)
grid on,axis tight,box on
xlabel('time [\mus]')
ylabel('V_i(t)')
set(gca,'FontSize',14)

subplot(122)
plot(r,P,'k',r,Pfit,'b','LineWidth',1.5)
grid on,axis tight,box on
xlabel('distance [nm]')
ylabel('P(r) [nm^{-1}]')
set(gca,'FontSize',14)
%% Studying the influence of the global weights
% By default, the global weights, i.e. how much influence each signal has on 
% the global fit, are chosen automatically based on the individual signal lengths 
% and approximate noise levels. However, this weights can be specified by passing 
% the option |'GlobalWeights|'. In this example, the signal |D1| has the largest 
% amount of points and the highest noise. Hence by default this signals will be 
% less weighted than the others. In this last section we want to study the effect 
% of setting all weights equal for all signals has on the gobal fit.

%Set all global weigths equal (w=1/3)
weights = ones(3,1)/3;

%Run global fit of time-domain parameteric model
Pfit = fitregmodel({D1,D2,D3},{K1,K2,K3},r,'tikh','aic','GlobalWeights',weights);

%Get the time-domain fits of all signals
D1fit = K1*Pfit;
D2fit = K2*Pfit;
D3fit = K3*Pfit;

%Plotting
figure('position',[0 0 600 200]),clf

subplot(121)
plot(t1,D1,'k.',t1,D1fit,'b',t2,D2+1/2,'k.',t2,D2fit+1/2,'b',t3,D3+1,'k.',t3,D3fit+1,'b','LineWidth',1)
grid on,axis tight,box on
xlabel('time [\mus]')
ylabel('V_i(t)')
set(gca,'FontSize',14)

subplot(122)
plot(r,P,'k',r,Pfit,'b','LineWidth',1.5)
grid on,axis tight,box on
xlabel('distance [nm]')
ylabel('P(r) [nm^{-1}]')
set(gca,'FontSize',14)
##### SOURCE END #####
--></body></html></div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example_globalfit_timedomain.html" class="btn btn-neutral float-right" title="Global fit of a time-domain parameteric 4-pulse DEER dipolar signal" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="example_selectmodel.html" class="btn btn-neutral float-left" title="Selecting an optimal parametric model for fitting a dipolar signal" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-2020, Luis FÃ¡bregas IbÃ¡Ã±ez, Stefan Stoll, and others

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>